// Values OwO
[class*="biteSizeOuter"] {
  --banner-height: 60px;
  --banner-offset: calc(120px - var(--banner-height));
  &:has(foreignObject > [style^="background-image"]) {
    --banner-height: 120px;
  }

  --edge-padding: 0px;
  &[class*="userProfileOuterThemed"] {
    --edge-padding: 4px;
  }

  --badge-container-height: 22px; // 0 rows (Minimal gap of 50px)
  &:has([class^="tags"] > [class^="container"] > div) {
    --badge-container-height: 30px; // 1 row
  }
  &:has([class^="tags"] > [class^="container"] > div:nth-child(9)) {
    --badge-container-height: 54px; // 2 rows
  }
  &:has([class^="tags"] > [class^="container"] > div:nth-child(17)) {
    --badge-container-height: 78px; // 3 rows, if anyone has more than 24 badges then tf are you doing with your life?
  }
}

// Section headers
@mixin eyebrow-font {
  display: flex;
  font-weight: 700;
  color: var(--header-primary) !important;
  font-family: var(--font-display);
  font-size: 12px;
  line-height: 1.3333;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

@mixin eyebrow($content, $margin-bottom) {
  content: $content;
  margin-bottom: $margin-bottom;
  width: 100%;
  @include eyebrow-font;
}

div {
  [class^="activityBiteSizePopout"] > [class^="headerContainer"] > h1, /* Both these top two are for activity headers which use semibold instead of eyebrow */
  [class^="activitySimplifiedProfile"] > [class^="headerContainer"] > h1,
  [class^="userProfileModalInner"] [class^="section"] > h1 /* For headers in the full profile which use semibold instead of eyebrow */ {
    @include eyebrow-font;
  }

  &:has(> [class^="descriptionClamp"])::before,
  [class^="userProfileModalInner"] [class^="scroller"] > [class^="markup"]::before {
    @include eyebrow("About Me", 6px);
  }

  &:has(> [data-list-id^="roles-"]):not(:has([data-text-variant="eyebrow"]))::before {
    @include eyebrow("Roles", 6px);
  }

  [class^="mutuals_"]::before {
    @include eyebrow("Mutuals", 4px); // .mutuals_dc9488 has a row-gap of 2px [2 + 4 = 6]
  }
}

// Fix static profiles
[class^="accountProfilePopoutWrapper"],
[class^="customizationSection"] {
  transform: translate3d(0, 0, 0);
}

// Fix static badges
[class^="customizationSection"] [class*="userProfileInner"] {
  [class^="tags"] > [class^="container"] {
    top: calc(40px + var(--banner-height)) !important;
  }
  > [class^="body"] > [class^="container"] {
    top: calc(56px + var(--banner-height) + var(--badge-container-height)) !important;
  }
}

// Fix profiles with no body or footer
[class*="biteSizeOuter"] > [class*="userProfileInner"] {
  &:not(:has(> footer > *)),
  &:has(footer > button [d^="m13.96 5.46 4.58 4.58a1"]):not(
      footer > *:not(button [d^="m13.96 5.46 4.58 4.58a1"])
    ) {
    > footer {
      visibility: hidden;
      padding: unset !important;
      margin: unset !important;
    }
    > [class^="body"] {
      border-bottom-left-radius: var(--radius-sm);
      border-bottom-right-radius: var(--radius-sm);
      margin-bottom: 16px;
      padding-bottom: 12px !important;
      &:not(:has(> div:nth-child(2) > *))::before {
        display: none;
      }
    }
  }
}

// Header without thumbnail
[class*="biteSizeOuter"]
  > [class*="userProfileInner"]
  > [class^="header"]:not(:has([style^="background-image"])) {
  > [class^="avatar"] {
    top: 16px;
    left: 22px;
  }
  > [class^="bannerSVGWrapper"] {
    min-width: unset !important;
    min-height: unset !important;
    mask {
      rect {
        width: 300px;
        height: 52.94px;
      }
      circle {
        cx: 54.5;
        cy: 49.5;
        r: 40.59;
      }
    }
    foreignObject {
      height: 52.95px;
      div {
        height: 52.94px;
        &::before {
          content: unset;
        }
      }
    }
  }
}

// Themed, headers without banners
[class*="biteSizeOuter"][class*="userProfileOuterThemed"] > [class*="userProfileInner"] {
  > [class^="body"] > [class^="container"] {
    margin: 0 20px 0;
  }
  > [class^="header"]:not(:has([style^="background-image"])) > [class^="bannerSVGWrapper"] {
    min-width: unset !important;
    min-height: unset !important;
    mask circle {
      cx: 51.25;
      cy: 46;
    }
  }
}

// Headers with banners unthemed
[class*="biteSizeOuter"]:not([class*="userProfileOuterThemed"]) > [class*="userProfileInner"] {
  > [class^="header"]:has([style^="background-image"]) > [class^="bannerSVGWrapper"] {
    min-width: unset !important;
    min-height: unset !important;
    mask circle {
      cx: 54.5 !important;
      cy: 102.5 !important;
    }
  }
}

[class*="biteSizeOuter"][class*="userProfileOuterThemed"]
  > [class*="userProfileInner"]
  [class*="pill"] {
  border: 1px solid var(--profile-role-pill-border-color);
}

// User profile
[class^="biteSizeOuter"] {
  // Layout
  width: 340px;
  box-sizing: unset;
  > [class*="userProfileInner"] {
    gap: unset;
    padding: unset;
    background: linear-gradient(
      var(--profile-gradient-primary-color),
      var(--profile-gradient-primary-color) var(--custom-user-banner-height-bite-size),
      var(--profile-gradient-secondary-color)
    );

    // About Me
    > [class^="body"] > div > {
      [class^="descriptionClamp"] {
        -webkit-line-clamp: unset;
        overflow: hidden scroll;
        max-height: 20vh;
        &::-webkit-scrollbar {
          width: 8px;
          height: 8px;
        }
        &::-webkit-scrollbar-thumb {
          background-clip: padding-box;
          border: 2px solid transparent;
          border-radius: 4px;
          background-color: var(--profile-body-divider-color);
        }
      }
      [class^="viewFullBio"] {
        display: none;
      }
    }

    // Activities
    [class^="activityBiteSizePopout"] {
      padding: unset;
      background: transparent !important;
      > img {
        width: 24px;
        height: 24px;
      }
    }

    // Popout profile
    [class^="channelTextArea"] > [class^="inner"] {
      background-color: transparent;
      border: 1px solid var(--profile-message-input-border-color);
    }
    [class*="pill"] {
      background-color: var(--profile-role-pill-background-color);
      border: unset;
      max-height: 22px;
      box-sizing: border-box;
    }

    > [class^="header"] {
      pointer-events: none;
      min-height: unset;
      z-index: unset;
      > [class^="avatar"] {
        pointer-events: initial;
        top: 76px;
        left: 22px;
        /* [class^="avatarStack"]::after {
          content: "View Profile";
          box-sizing: border-box;
          font-size: 10px;
          line-height: 12px;
          font-weight: 700;
          display: flex;
          align-items: center;
          justify-content: center;
          white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          text-transform: uppercase;
          box-shadow: inset 0 0 120px hsl(var(--black-500-hsl) / 0.75);
          color: var(--white-500);
          transition: opacity 0.1s ease;
          background-color: unset;
        } */
      }
      > [class^="bannerSVGWrapper"] {
        padding: 0 0 calc(83px + var(--badge-container-height) - var(--banner-offset));
        display: block;
        &:has(foreignObject > [style^="background-image"]) {
          transform: scaleY(1.0084) translateY(1px);
          mask circle {
            cx: 51;
            cy: 99;
            r: 40.59;
            transform: scaleY(0.9916);
          }
        }
      }
    }
    &:has([class^="pronounsTooltip"]) [class^="header"] {
      > [class^="bannerSVGWrapper"] {
        padding: 0 0 calc(103px + var(--badge-container-height) - var(--banner-offset));
      }
    }

    // Popout profile
    > [class^="body"] {
      gap: 12px;
      margin: 0 16px 0;
      padding: 0 12px 12px !important;
      overflow: unset !important;
      background-color: var(--profile-body-background-color);
      &::before {
        content: "";
        display: block;
        margin: 12px 0 0;
        height: 1px;
        background-color: var(--profile-body-divider-color);
      }
      > [class^="container"] {
        position: fixed;
        top: calc(
          28px + var(--banner-height) + var(--badge-container-height) + var(--edge-padding)
        );
        left: 0px;
        margin: 0 16px 0;
        padding: 12px 12px 0;
        border-top-left-radius: var(--radius-sm);
        border-top-right-radius: var(--radius-sm);
        background-color: var(--profile-body-background-color);
        width: -webkit-fill-available;
        > [class^="usernameRow"] {
          > [class^="clickableUsername"] > h1 {
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            word-break: break-all;
            display: -webkit-box;
            font-weight: 600;
          }
          > [class^="nicknameIcons"] {
            display: none;
          }
        }
      }
      &[class*="biteSizeInnerThemed"] {
        gap: unset;
      }
    }

    [class^="tags"] {
      > [class^="container"] /* Badges */ {
        position: fixed;
        justify-content: flex-end;
        right: calc(16px + var(--edge-padding));
        top: calc(12px + var(--banner-height) + var(--edge-padding));
        margin: unset;
        border: unset;
        border-radius: 8px;
        box-sizing: content-box;
        max-width: 190px;
        padding: 4px;
        background-color: var(--profile-body-background-color);
        div > a {
          > img,
          > div {
            width: 22px;
            height: 22px;
          }
        }
      }
      > [class^="clickableUsername"],
      > [class*="userTag"] {
        width: 100%;
        > [class^="info"] {
          font-weight: 500;
        }
      }
      > [class^="dotSpacer"] {
        display: none;
      }
    }

    > [class^="footer"] {
      margin: 0 16px 16px;
      padding: 0 12px 12px;
      background-color: var(--profile-body-background-color);
      border-bottom-left-radius: var(--radius-sm);
      border-bottom-right-radius: var(--radius-sm);
      > button:has(> [class^="contents"] > svg > [d^="m13.96 5.46 4.58 4.58a1"]) {
        visibility: visible;
        width: 32px;
        height: 32px;
        font-size: 0;
        padding: unset;
        min-width: unset;
        min-height: unset;
        background: hsl(var(--black-500-hsl) / 0.7);
        color: var(--white-500);
        border-radius: var(--radius-round);
        transition:
          background-color var(--custom-button-transition-duration) ease,
          color var(--custom-button-transition-duration) ease;
        position: absolute;
        top: 12px;
        right: 12px;
        [class^="contents"] {
          margin: unset;
          gap: unset;
        }
        &:hover {
          background: hsl(var(--black-500-hsl) / 0.85);
          opacity: unset;
        }
      }
    }

    // Custom status
    [class^="invisibleContainer"] {
      display: none;
    }
    [class^="visibleContainer"] {
      position: static;
      pointer-events: initial;
    }
    [class^="statusBubbleOuter"] {
      border: unset !important;
      background: var(--profile-body-background-color);
      box-shadow: none;
      margin: 0 16px 0;
      padding: 12px 12px 0;
      border-radius: unset;
      max-width: unset;
      &::before,
      &::after {
        display: none;
      }
      > [class*="statusBubble"] {
        min-width: unset;
        max-width: unset;
        padding: unset;
        background: transparent;
        > [class^="content"] {
          text-align: start;
          -webkit-line-clamp: unset;
          max-height: unset !important;
          > [class*="statusText"] {
            font-weight: 400;
          }
          > [class*="statusEmojiOnly"] {
            user-select: none;
            cursor: initial;
            width: 48px;
            height: 48px;
            // WHY DISCORD???
            min-width: unset;
            min-height: unset;
            max-width: unset;
            max-height: unset;
          }
          > [class*="statusEmojiInline"] {
            user-select: none;
            cursor: initial;
            margin: -1px 4px -1px 0;
            width: 20px;
            height: 20px;
          }
        }
      }
    }
  }
}
